{% extends 'base.html' %}
{% load static %}

{% block title %}ë‹¨ê±´ ì…ë ¥ | ë¬¸ì‹œí¬42{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/form.css' %}">
{% endblock %}

{% block content %}
  <div class="container">
    <h1>ğŸ§’ ì•„ë™ ìœ„í—˜ ì˜ˆì¸¡</h1>

    <form method="post" class="prediction-form" action="{% url 'predict' %}">
      {% csrf_token %}
      <div class="form-row"><label>ì•„ë™ ì´ë¦„</label>{{ form.child_name }}</div>
      <div class="form-row"><label>ë‚˜ì´</label>{{ form.age }}</div>
      <div class="form-row"><label>ì„±ë³„</label>{{ form.gender }}</div>
      <div class="form-row"><label>ì¶œì„ íŒ¨í„´</label>{{ form.attendance }}</div>
      <div class="form-row"><label>ë¶€ì • ì–¸ì–´ í‘œí˜„</label>{{ form.negative_language }}</div>
      <div class="form-row"><label>ë³´í˜¸ì ê³µê²©ì„±</label>{{ form.parental_aggression }}</div>
      <div class="form-row"><label>ì‹ ì²´ì ‘ì´‰ ë°˜ì‘</label>{{ form.contact_reaction }}</div>
      <div class="form-row"><label>í˜•ì œìë§¤ ìˆ˜</label>{{ form.sibling }}</div>
      <div class="form-row"><label>ì†Œë“ ìˆ˜ì¤€</label>{{ form.income_level }}</div>
      <div class="form-row"><label>ë³´í˜¸ì ì •ì„œ ìƒíƒœ</label>{{ form.emotional_state }}</div>
      <button type="submit">ì˜ˆì¸¡í•˜ê¸°</button>
    </form>

    {% if result %}
      <div class="result-box"><strong>{{ result }}</strong></div>
    {% endif %}

    {% if accuracy %}
      <div class="accuracy-box">ğŸ” <strong>{{ accuracy }}</strong></div>
    {% endif %}

    {% if input_values and feature_means %}
      <div style="width: 90%; margin: 2rem auto">
        <canvas id="compareChart"></canvas>
      </div>
    {% endif %}
  </div>
{% endblock %}

{% block extra_script %}
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  {% if input_values and feature_means %}
  <script>
    const ctx = document.getElementById('compareChart').getContext('2d');
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: ['ë‚˜ì´', 'ì„±ë³„', 'ì¶œì„íŒ¨í„´', 'ë¶€ì •ì–¸ì–´í‘œí˜„', 'ë³´í˜¸ìê³µê²©ì„±', 'ì‹ ì²´ì ‘ì´‰ë°˜ì‘', 'í˜•ì œìë§¤ìˆ˜', 'ì†Œë“ìˆ˜ì¤€', 'ë³´í˜¸ìì •ì„œìƒíƒœ'],
        datasets: [
          {
            label: 'ì…ë ¥ê°’',
            data: {{ input_values|safe }},
            borderColor: 'rgba(255, 99, 132, 1)',
            backgroundColor: 'rgba(255, 99, 132, 0.2)',
            borderWidth: 2,
            fill: false,
            tension: 0.3
          },
          {
            label: 'í‰ê· ê°’',
            data: {{ feature_means|safe }},
            borderColor: 'rgba(54, 162, 235, 1)',
            backgroundColor: 'rgba(54, 162, 235, 0.2)',
            borderWidth: 2,
            borderDash: [5, 5],
            fill: false,
            tension: 0.3
          }
        ]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'top' },
          tooltip: { mode: 'index', intersect: false }
        },
        scales: {
          y: { beginAtZero: true, ticks: { stepSize: 1 } }
        }
      }
    });
  </script>
  {% endif %}
{% endblock %}